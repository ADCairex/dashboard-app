version: "3.8"

services:
  app:
    image: dashboard-chatbot-app:latest
    networks:
      - network_public
    environment:
      NODE_ENV: production
      PORT: 8080

      # Variables que no son secretas o que no te importa exponer aqu√≠
      DB_USER: postgres
      DB_HOST: pgvector
      DB_PORT: 5432
      DB_DATABASE: empresas_nopremium
      DB_SCHEMA: juanfran_asencio
      DB_PASSWORD: dummy_value

      ADMIN_USER: admin
      ADMIN_PASSWORD: dummy_value

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

    deploy:
      replicas: 1
      placement:
        constraints:
          - node.role == manager
      restart_policy:
        condition: on-failure
      labels:
        - "traefik.enable=true"

        # Interfaz principal de Dashboard APP
        - "traefik.http.routers.dashboard-app.rule=Host(`test-whatsapp.aiflowlogic.com`)"
        - "traefik.http.routers.dashboard-app.entrypoints=websecure"
        - "traefik.http.routers.dashboard-app.tls.certresolver=letsencryptresolver"
        - "traefik.http.routers.dashboard-app.service=dashboard-app-ui"
        - "traefik.http.services.dashboard-app-ui.loadbalancer.server.port=8080"

networks:
  network_public:
    external: true
